<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width,initial-scale=1">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="icon" href="{{ url_for('static', filename='images/image.png') }}">
        <link href="https://fonts.googleapis.com/css2?family=Sekuya&display=swap" rel="stylesheet">
        <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/gamify.css') }}">
        <link rel="icon" href="{{ url_for('static', filename='images/image2.png') }}">
        <title>{{ game.gameName }} - Gamify</title>
    </head>
    <script>
        if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/static/sw.js')
            .then(() => console.log('SW registered'))
            .catch(err => console.error('SW failed', err));
        }
    </script>
    <body class="game-details">
        <header class="site-header">
            <a href="{{ url_for('home') }}"><div class="brand"><img src="{{ url_for('static', filename='images/GAMIFY_LOGO.png') }}" alt="Gamify logo" width="150px"></div></a>
            <div class="search-slot">
            <form class="header-search" role="search" action="{{ url_for('home') }}" method="get">
                <input type="search" name="q" value="{{ query|default('') }}" placeholder="Search games, genres, developers..." aria-label="Search games">
                <button type="submit">Search</button>
            </form>
            </div>
            <button class="menu-toggle" onclick="menuToggle()">
                <img src="{{ url_for('static', filename='images/white-menu-icon-12.jpg') }}" alt="Menu" width="50px">
            </button>
            <div class="menu">
                <h2 style="color: #fff; text-align: left; margin: 20px" class="menu-title">Menu</h2>
                <nav class="side-nav">
                    <a class="nav-link" href="{{ url_for('login') }}">Sign In</a>
                    <a class="nav-link" href="{{ url_for('signup') }}">Sign Up</a>
                    <a class="nav-link" href="{{ url_for('profile') }}">Profile</a>
                    <a class="nav-link" href="{{ url_for('library') }}">Library</a>
                </nav>
                <div class="menu-slot">
                    <form class="header-search menu-search" role="search" action="{{ url_for('home') }}" method="get">
                        <input type="search" name="q" value="{{ query|default('') }}" placeholder="Search games, genres, developers..." aria-label="Search games">
                        <button type="submit">Search</button>
                    </form>
                </div>
            </div>
        </header>

        <header class="game-hero">
            <img src="{{ game.banner }}" alt="{{ game.gameName }}">
            <div class="hero-overlay"></div>
        </header>

        <main class="game-content hidden">
            <form class="libraryForm" action="{{ url_for('add_to_library', game_id=game.gameID) }}" style="display: inline;" method="POST">
                <button type="submit" style="position: absolute; top: 0px; right: 30px; background: transparent; border: none; cursor: pointer; z-index: 1000;">
                    <img src="{{ url_for('static', filename='images/bookmark-ribbon--v2.png') }}" alt="Add to Library" class="bookmark-detail">
                </button>
            </form>
            <div class="game-title">
                    <img style="width: 300px; display: block; margin: auto;" src="{{ game.logo }}" alt="{{ game.gameName }}">
                    <p style="margin: 20px 0px 20px 0px; text-align: center; font-family: 'Sekuya', sans-serif;">{{ game.genre }} • {{ game.gameDev }}</p>
            </div>
            <a href="{{ url_for('game_reviews', game_id=game.gameID) }}"><button class="review-button">Review</button></a>
            <div class="game-rating" style="width: 50%; margin: auto; text-align: center; padding-bottom: 24px; margin-top: 50px;">
                {% if rating.reviewCount > 0 %}
                    <p>
                        ⭐ {{ rating.avgRating }}/10
                        ({{ rating.reviewCount }} reviews)
                    </p>
                    <a href="{{ url_for('game_reviews', game_id=game.gameID) }}" style="text-decoration: none; color: var(--accent); font-weight: 700;">
                        View reviews
                    </a>
                {% else %}
                    <p>No reviews yet</p>
                {% endif %}
            </div>
            <section>
                <h2>About the Game</h2>
                <p>{{ game.gameDesc }}</p>
            </section>
            {% if game.trailer %}
            <section class="detail-centered">
                <h2>Trailer</h2>
                <div class="media-wrapper">
                    <iframe src="{{ game.trailer }}" allowfullscreen></iframe>
                </div>
            </section>
            {% endif %}
            {% if game.sysReqs %}
            <section class="detail-centered">
                <h2>System Requirements</h2>
                <p>{{ game.sysReqs }}</p>
            </section>
            {% endif %}
            {% if game.patchNotes %}
            <section class="detail-centered">
                <h2>Latest Patch Notes</h2>
                <p>{{ game.patchNotes }}</p>
            </section>
            {% endif %}
        </main>

        <script>
            window.addEventListener('load', () => {
                const content = document.querySelector('.game-content');
                if (content) {
                setTimeout(() => {
                    content.classList.remove('hidden');
                }, 450); // AFTER hero animation
                }
            });
        </script>
        
        <script>
            const menu = document.querySelector('.menu');
            const menutoggle = document.querySelector('.menu-toggle');

            function menuToggle() {
                const isOpen = menu.classList.contains('open');

                menu.classList.toggle('open', !isOpen);
                menutoggle.style.zIndex = isOpen ? '2' : '1001';
            }
        </script>

        <footer class="site-footer">
            <small>© Gamify — Games catalogue demo</small>
        </footer>
    </body>